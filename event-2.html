<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>THE GRAND CELEBRATION | VIP Invite</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;800&family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&family=Montserrat:wght@200;400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            'luxury': ['Cinzel', 'serif'],
            'elegant': ['Cormorant Garamond', 'serif'],
            'modern': ['Montserrat', 'sans-serif'],
          }
        }
      }
    }
  </script>

  <style>
    :root{
      /* Varsayƒ±lan Deƒüerler (JS ile ezilecek) */
      --bg: #050505;
      --panel: rgba(255,255,255,.05);
      --panel2: rgba(0,0,0,.35);
      --line: rgba(255,255,255,.10);
      --muted: rgba(255,255,255,.55);
      --text: rgba(255,255,255,.92);
      --accent: #D4AF37;  
      --accent2: #8A7036; 
      --shadow: 0 30px 80px rgba(0,0,0,.55);
      --radius: 18px;
    }

    body { background-color: var(--bg); color: var(--text); overflow-x: hidden; transition: background-color 0.8s ease, color 0.8s ease; }

    /* Helper Classes */
    .accent-text{ color: var(--accent); }
    .accent-dim{ color: var(--accent2); }
    .accent-border{ border-color: color-mix(in srgb, var(--accent) 35%, transparent); }
    .panel{ background: var(--panel); }
    .panel-strong{ background: var(--panel2); }
    .soft-line{ border-color: var(--line); }

    /* --- YENƒ∞ EKLENEN L√úKS STƒ∞LLER --- */

    /* 1. Kaƒüƒ±t Dokusu */
    .paper-texture {
      position: fixed; inset: 0; pointer-events: none; z-index: 1;
      opacity: 0.4;
      background-image: url('https://www.transparenttextures.com/patterns/cream-paper.png');
      mix-blend-mode: overlay;
    }

    /* 2. Baroque √áer√ßeve (Sadece VIP temada g√∂r√ºn√ºr) */
    .baroque-frame {
      display: none; 
      position: fixed; inset: 10px; pointer-events: none; z-index: 100;
      border: 1px solid color-mix(in srgb, var(--accent) 30%, transparent);
      box-shadow: inset 0 0 60px rgba(0,0,0,0.8);
    }
    .baroque-frame::before {
      content: ""; position: absolute; inset: 4px;
      border: 2px solid color-mix(in srgb, var(--accent) 60%, transparent);
    }
    .baroque-frame::after {
      content: ""; position: absolute; inset: -10px;
      background: 
        radial-gradient(circle at top left, transparent 65%, var(--accent) 66%, transparent 67%),
        radial-gradient(circle at top right, transparent 65%, var(--accent) 66%, transparent 67%),
        radial-gradient(circle at bottom left, transparent 65%, var(--accent) 66%, transparent 67%),
        radial-gradient(circle at bottom right, transparent 65%, var(--accent) 66%, transparent 67%);
      background-size: 60px 60px;
      background-repeat: no-repeat;
      background-position: top left, top right, bottom left, bottom right;
      opacity: 0.8;
    }
    body.theme-vip .baroque-frame { display: block; }

    /* 3. Light Mode Override (Ivory/Floral temalar i√ßin okunaklƒ±lƒ±k) */
    body.light-mode .panel { background: rgba(0,0,0, 0.03); border-color: rgba(0,0,0, 0.08); }
    body.light-mode .panel-strong { background: rgba(0,0,0, 0.06); }
    body.light-mode input, body.light-mode select, body.light-mode textarea {
      background: rgba(255,255,255, 0.6); color: #000; border-color: rgba(0,0,0, 0.2);
    }
    body.light-mode input::placeholder, body.light-mode textarea::placeholder { color: rgba(0,0,0, 0.5); }
    body.light-mode .text-gray-300 { color: rgba(0,0,0, 0.75) !important; }
    body.light-mode .text-gray-400 { color: rgba(0,0,0, 0.65) !important; }
    body.light-mode .text-gray-500 { color: rgba(0,0,0, 0.55) !important; }
    body.light-mode .text-white { color: rgba(0,0,0, 0.9) !important; }
    body.light-mode .text-white\/80 { color: rgba(0,0,0, 0.8) !important; }
    body.light-mode .text-white\/70 { color: rgba(0,0,0, 0.7) !important; }
    
    /* ------------------------------------- */

    /* GOLD SHINE TEXT */
    .text-gold-shine {
      background: linear-gradient(to right, #BF953F, #FCF6BA, #B38728, #FBF5B7, #AA771C);
      -webkit-background-clip: text; background-clip: text; color: transparent;
      background-size: 200% auto; animation: shine 6s linear infinite;
    }
    @keyframes shine { to { background-position: 200% center; } }

    /* Scroll hide */
    .hide-scrollbar::-webkit-scrollbar { display: none; }
    .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

    /* Entrance screen */
    #entrance-screen {
      position: fixed; inset: 0; z-index: 110; background: #000;
      display: flex; align-items: center; justify-content: center;
      transition: transform 1.2s cubic-bezier(0.77, 0, 0.175, 1);
      will-change: transform;
    }
    .envelope-hidden { transform: translateY(-100%); }

    /* PIN gate */
    #pin-screen{
      position: fixed; inset: 0; z-index: 120;
      display: none; align-items: center; justify-content: center;
      background: radial-gradient(900px 420px at 50% 10%, rgba(212,175,55,.10), rgba(0,0,0,.92));
    }
    #pin-screen.active{ display:flex; }

    /* reveal */
    .reveal { opacity: 0; transform: translateY(30px); transition: all 1s ease-out; }
    .reveal.active { opacity: 1; transform: translateY(0); }

    /* video overlay */
    .video-overlay {
      position:absolute; inset:0;
      background: radial-gradient(900px 420px at 50% 10%, rgba(212,175,55,.10), rgba(0,0,0,.55));
      pointer-events:none;
    }

    /* tiny shake for wrong pin */
    @keyframes shake {
      0%,100%{ transform: translateX(0); }
      20%{ transform: translateX(-6px); }
      40%{ transform: translateX(6px); }
      60%{ transform: translateX(-4px); }
      80%{ transform: translateX(4px); }
    }
    .shake{ animation: shake .35s ease-in-out; }

    /* Admin modal */
    #adminModal{
      position: fixed; inset:0; z-index: 200;
      display:none; align-items:center; justify-content:center;
      background: rgba(0,0,0,.72);
      padding: 18px;
    }
    #adminModal.open{ display:flex; }
  </style>
</head>

<body class="font-modern">
  
  <div class="paper-texture"></div>
  <div class="baroque-frame"></div>

  <div id="pin-screen" aria-modal="true" role="dialog">
    <div class="w-full max-w-md mx-auto px-6 relative z-50">
      <div class="panel border soft-line rounded-2xl p-8 shadow-[0_30px_80px_rgba(0,0,0,.55)]">
        <div class="text-center">
          <div class="w-20 h-20 mx-auto mb-5 rounded-full border soft-line flex items-center justify-center relative">
            <div class="absolute inset-0 rounded-full" style="background: rgba(212,175,55,.10);"></div>
            <span class="font-luxury text-4xl accent-text" id="pinMonogram">S</span>
          </div>
          <h2 class="font-luxury text-white text-xl tracking-[0.35em] mb-2">VIP ACCESS</h2>
          <p class="text-xs" style="color: var(--muted); letter-spacing:.14em; text-transform:uppercase;">
            Enter your private code
          </p>
        </div>

        <div class="mt-8" id="pinBox">
          <label class="text-xs uppercase tracking-widest" style="color: var(--muted);">Access Code</label>
          <input id="pinInput" inputmode="numeric" maxlength="10" 
                 class="mt-2 w-full bg-black/30 border-b border-white/20 py-3 text-white focus:outline-none focus:border-[color:var(--accent)] transition placeholder-gray-600"
                 placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
          <div class="mt-3 flex items-center justify-between gap-3">
            <label class="text-xs" style="color: var(--muted);">
              <input type="checkbox" id="rememberDevice" class="mr-2 align-middle" />
              Remember this device
            </label>
            <button id="pinSubmit" 
              class="px-5 py-2 rounded-full border soft-line text-xs hover:border-[color:var(--accent)] transition"
              style="background: rgba(0,0,0,.35);">
              Unlock
            </button>
          </div>
          <p id="pinError" class="text-xs mt-3 hidden" style="color: rgba(255,255,255,.75);">
            Incorrect code. Please try again.
          </p>
        </div>

        <div class="mt-8 border-t soft-line pt-5">
          <p class="text-[11px]" style="color: var(--muted); line-height:1.6;">
            This invitation is delivered as a private shareable link. No downloads required.
          </p>
        </div>
      </div>
    </div>
  </div>

  <div id="entrance-screen">
    <div class="text-center relative px-6 z-50">
      <div class="w-24 h-24 mx-auto mb-8 rounded-full border-2 soft-line flex items-center justify-center relative">
        <div class="absolute inset-0 rounded-full" style="background: rgba(212,175,55,.10);"></div>
        <span class="font-luxury text-4xl accent-text" id="monogram">S</span>
      </div>
      <h2 class="font-luxury text-white text-xl tracking-[0.4em] mb-2" id="privateLabel">PRIVATE EVENT</h2>
      <p class="text-gray-500 text-xs mb-10 tracking-widest uppercase" id="clickLabel">Click to Reveal Invitation</p>

      <button id="open-btn" 
        class="group relative px-8 py-4 bg-transparent border accent-border text-[color:var(--accent)] font-luxury tracking-widest hover:bg-[color:var(--accent)] hover:text-black transition duration-500">
        OPEN ENVELOPE
      </button>

      <div class="mt-10 flex flex-wrap justify-center gap-2">
        <button class="themeBtn px-4 py-2 rounded-full text-[11px] border soft-line hover:border-[color:var(--accent)] transition text-white" data-theme="vip">
          Dark VIP
        </button>
        <button class="themeBtn px-4 py-2 rounded-full text-[11px] border soft-line hover:border-[color:var(--accent)] transition text-white" data-theme="ivory">
          Minimal Ivory
        </button>
        <button class="themeBtn px-4 py-2 rounded-full text-[11px] border soft-line hover:border-[color:var(--accent)] transition text-white" data-theme="floral">
          Soft Floral
        </button>
        <button class="themeBtn px-4 py-2 rounded-full text-[11px] border soft-line hover:border-[color:var(--accent)] transition text-white" data-theme="boho">
          Boho Earth
        </button>
      </div>
      <p class="mt-3 text-[11px]" style="color: var(--muted);">Theme is adjustable per client before delivery.</p>
    </div>
  </div>

  <div id="main-content" class="relative min-h-screen z-10">

    <audio id="bgMusic" loop preload="metadata">
      <source src="assets/music.mp3" type="audio/mpeg">
    </audio>

    <button id="music-btn" 
      class="fixed bottom-6 right-6 z-50 w-12 h-12 panel-strong backdrop-blur border accent-border rounded-full accent-text flex items-center justify-center shadow-[0_0_15px_rgba(212,175,55,0.25)] hover:scale-110 transition"
      aria-label="Music" aria-pressed="false" title="Music">
      <i class="fa-solid fa-music"></i>
    </button>

    <div class="fixed bottom-6 left-6 z-50 hidden md:flex flex-col gap-3">
      <button id="share-btn" class="px-4 py-3 panel-strong border soft-line rounded-full text-xs text-white/80 hover:text-white hover:border-[color:var(--accent)] transition backdrop-blur">
        <i class="fa-solid fa-link mr-2"></i> Share Link
      </button>
      <a href="#rsvp" class="px-4 py-3 panel-strong border soft-line rounded-full text-xs text-white/80 hover:text-white hover:border-[color:var(--accent)] transition backdrop-blur">
        <i class="fa-solid fa-pen-to-square mr-2"></i> RSVP
      </a>
      <a href="#map" class="px-4 py-3 panel-strong border soft-line rounded-full text-xs text-white/80 hover:text-white hover:border-[color:var(--accent)] transition backdrop-blur">
        <i class="fa-solid fa-location-dot mr-2"></i> Directions
      </a>
    </div>

    <div id="a2hs" 
      class="fixed top-4 left-1/2 -translate-x-1/2 z-50 hidden md:block px-4 py-3 panel-strong border soft-line rounded-full text-[11px] text-white/70 backdrop-blur">
      Tip: On iPhone, tap <span class="accent-text font-semibold">Share</span> ‚Üí <span class="accent-text font-semibold">Add to Home Screen</span>
      <button id="a2hsClose" class="ml-3 opacity-70 hover:opacity-100"><i class="fa-solid fa-xmark"></i></button>
    </div>

    <header class="relative pt-24 pb-16 text-center px-4 overflow-hidden">
      
      <div class="absolute inset-0 -z-10">
        <video id="bgVideo" class="w-full h-full object-cover opacity-20" playsinline muted loop preload="metadata">
          <source src="assets/bg.mp4" type="video/mp4">
        </video>
        <div class="video-overlay"></div>
      </div>

      <p class="tracking-[0.3em] text-xs uppercase mb-6 reveal" style="color: var(--muted);" id="heroTop">
        Join us for the 30th Birthday of
      </p>

      <h1 class="font-luxury text-6xl md:text-8xl text-gold-shine mb-6 drop-shadow-2xl reveal" id="heroName">
        SOPHIA
      </h1>

      <div class="h-px w-32 mx-auto mb-6 reveal" style="background: linear-gradient(to right, transparent, var(--accent), transparent);"></div>

      <p class="font-elegant text-2xl text-white/80 italic reveal" id="heroQuote">
        "A Night of Elegance & Memories"
      </p>

      <div class="mt-8 reveal">
        <span id="eventStatusBadge" 
          class="inline-flex items-center gap-2 px-4 py-2 rounded-full border soft-line panel-strong text-xs text-white/80 backdrop-blur">
          <i class="fa-regular fa-clock"></i> 
          <span id="eventStatusText">Counting down</span>
        </span>
      </div>

      <div class="max-w-4xl mx-auto mt-10 px-6 reveal">
        <div class="grid md:grid-cols-3 gap-4">
          <div class="panel border soft-line rounded-xl p-4 text-center">
            <div class="text-xs tracking-widest uppercase text-gray-500 mb-2">QR ¬∑ RSVP</div>
            <div class="mx-auto w-[120px] h-[120px] panel-strong rounded-lg border soft-line flex items-center justify-center" id="qr-rsvp">
              <span class="text-gray-600 text-xs">Loading‚Ä¶</span>
            </div>
          </div>
          
          <div class="panel border soft-line rounded-xl p-4 text-center">
            <div class="text-xs tracking-widest uppercase text-gray-500 mb-2">QR ¬∑ Map</div>
            <div class="mx-auto w-[120px] h-[120px] panel-strong rounded-lg border soft-line flex items-center justify-center" id="qr-map">
              <span class="text-gray-600 text-xs">Loading‚Ä¶</span>
            </div>
          </div>

          <div class="panel border soft-line rounded-xl p-4 text-center">
            <div class="text-xs tracking-widest uppercase text-gray-500 mb-2">QR ¬∑ Share</div>
            <div class="mx-auto w-[120px] h-[120px] panel-strong rounded-lg border soft-line flex items-center justify-center" id="qr-share">
              <span class="text-gray-600 text-xs">Loading‚Ä¶</span>
            </div>
          </div>
        </div>

        <p class="text-gray-500 text-[11px] mt-4">
          QR codes are generated from this page‚Äôs links. In final delivery, they will point to the private shareable link.
        </p>
      </div>
    </header>

    <section class="max-w-4xl mx-auto px-6 mb-12">
      <div class="relative aspect-video rounded-xl overflow-hidden border accent-border shadow-2xl reveal group" id="momentWrap">
        <div class="absolute inset-0" style="background: rgba(212,175,55,.06);"></div>
        
        <video id="momentVideo" class="w-full h-full object-cover relative z-10" playsinline controls preload="metadata">
          <source src="assets/moment.mp4" type="video/mp4">
        </video>

        <div class="absolute bottom-3 left-3 z-20 text-[11px] text-white/70 panel-strong px-3 py-2 rounded-full border soft-line backdrop-blur">
          Optional ‚Äúmoment‚Äù video
        </div>
      </div>
    </section>

    <section class="max-w-4xl mx-auto px-6 mb-24">
      <div class="grid grid-cols-4 gap-4 text-center border-y soft-line py-8 reveal">
        <div>
          <span class="block font-luxury text-3xl md:text-5xl accent-text" id="days">00</span>
          <span class="text-xs text-gray-500 uppercase tracking-widest">Days</span>
        </div>
        <div>
          <span class="block font-luxury text-3xl md:text-5xl accent-text" id="hours">00</span>
          <span class="text-xs text-gray-500 uppercase tracking-widest">Hrs</span>
        </div>
        <div>
          <span class="block font-luxury text-3xl md:text-5xl accent-text" id="minutes">00</span>
          <span class="text-xs text-gray-500 uppercase tracking-widest">Mins</span>
        </div>
        <div>
          <span class="block font-luxury text-3xl md:text-5xl accent-text" id="seconds">00</span>
          <span class="text-xs text-gray-500 uppercase tracking-widest">Secs</span>
        </div>
      </div>

      <p class="text-center text-gray-600 text-xs mt-4" id="tzHint">Time shown in your local timezone.</p>
      
      <div class="flex flex-wrap justify-center gap-3 mt-6 reveal">
        <button id="ics-btn" class="px-6 py-3 border accent-border rounded-full text-xs text-white/80 hover:text-white hover:border-[color:var(--accent)] transition">
          <i class="fa-regular fa-calendar mr-2"></i> Download Calendar (.ics)
        </button>
        <a id="gcal-link" target="_blank" rel="noopener"
           class="px-6 py-3 border accent-border rounded-full text-xs text-white/80 hover:text-white hover:border-[color:var(--accent)] transition"
           href="#">
          <i class="fa-brands fa-google mr-2"></i> Add to Google Calendar
        </a>
      </div>
    </section>

    <section class="max-w-5xl mx-auto px-6 grid md:grid-cols-2 gap-12 mb-24 reveal" id="details">
      <div class="space-y-12 text-center md:text-right">
        <div>
          <i class="fa-regular fa-clock text-3xl accent-text mb-4"></i>
          <h3 class="font-luxury text-2xl text-white mb-2">When</h3>
          <p class="font-elegant text-xl text-gray-300" id="whenDate">Saturday, October 25th</p>
          <p class="accent-text font-bold" id="whenTime">19:00 - Late</p>
        </div>

        <div>
          <i class="fa-solid fa-location-dot text-3xl accent-text mb-4"></i>
          <h3 class="font-luxury text-2xl text-white mb-2">Where</h3>
          <p class="font-elegant text-xl text-gray-300" id="whereName">The Grand Ballroom</p>
          <p class="text-gray-500 text-sm" id="whereAddress">123 Luxury Ave, Manhattan, NY</p>
          
          <div class="flex flex-wrap justify-center md:justify-end gap-3 mt-4">
            <a id="map-google" target="_blank" rel="noopener" 
               class="px-5 py-2 border soft-line rounded-full text-[11px] text-white/70 hover:text-white hover:border-[color:var(--accent)] transition"
               href="#">Google Maps</a>
            <a id="map-apple" target="_blank" rel="noopener" 
               class="px-5 py-2 border soft-line rounded-full text-[11px] text-white/70 hover:text-white hover:border-[color:var(--accent)] transition"
               href="#">Apple Maps</a>
            <a id="map-waze" target="_blank" rel="noopener" 
               class="px-5 py-2 border soft-line rounded-full text-[11px] text-white/70 hover:text-white hover:border-[color:var(--accent)] transition"
               href="#">Waze</a>
          </div>
        </div>
      </div>

      <div class="space-y-12 text-center md:text-left border-t md:border-t-0 md:border-l soft-line pt-12 md:pt-0 md:pl-12">
        <div>
          <i class="fa-solid fa-vest text-3xl accent-text mb-4"></i>
          <h3 class="font-luxury text-2xl text-white mb-2">Dress Code</h3>
          <p class="font-elegant text-xl text-gray-300 mb-4" id="dressCode">Black Tie / Formal</p>
          
          <div class="flex justify-center md:justify-start gap-4" id="palette">
            <div class="w-8 h-8 rounded-full bg-black border soft-line" title="Black"></div>
            <div class="w-8 h-8 rounded-full" style="background: var(--accent);" title="Accent"></div>
            <div class="w-8 h-8 rounded-full" style="background: #1B2430;" title="Navy"></div>
          </div>
          
          <p class="text-xs text-gray-600 mt-2" id="paletteNote">Please stick to the palette.</p>
        </div>

        <div>
          <i class="fa-solid fa-gift text-3xl accent-text mb-4"></i>
          <h3 class="font-luxury text-2xl text-white mb-2">Registry</h3>
          <p class="text-gray-400 text-sm mb-4" id="registryNote">Your presence is the greatest gift.</p>
          <a id="registryLink" href="#" target="_blank" rel="noopener" 
             class="px-6 py-2 border soft-line rounded-full text-xs hover:bg-white hover:text-black transition">
            View Wishlist
          </a>
        </div>
      </div>
    </section>

    <section class="max-w-2xl mx-auto px-6 mb-24 reveal">
      <h2 class="font-luxury text-2xl accent-text mb-6 text-center">Guest Guide</h2>

      <div class="space-y-4">
        <details class="group panel border soft-line rounded-lg overflow-hidden">
          <summary class="flex justify-between items-center p-4 cursor-pointer text-white font-modern">
            <span><i class="fa-solid fa-car-side mr-2" style="color: color-mix(in srgb, var(--accent) 70%, transparent);"></i>Parking / Arrival</span>
            <span class="accent-text group-open:rotate-180 transition">+</span>
          </summary>
          <div class="p-4 pt-0 text-gray-400 text-sm leading-relaxed" id="parkingInfo"></div>
        </details>

        <details class="group panel border soft-line rounded-lg overflow-hidden">
          <summary class="flex justify-between items-center p-4 cursor-pointer text-white font-modern">
            <span><i class="fa-solid fa-phone mr-2" style="color: color-mix(in srgb, var(--accent) 70%, transparent);"></i>Contact</span>
            <span class="accent-text group-open:rotate-180 transition">+</span>
          </summary>
          <div class="p-4 pt-0 text-gray-400 text-sm leading-relaxed" id="contactInfo"></div>
        </details>

        <details class="group panel border soft-line rounded-lg overflow-hidden">
          <summary class="flex justify-between items-center p-4 cursor-pointer text-white font-modern">
            <span><i class="fa-solid fa-circle-info mr-2" style="color: color-mix(in srgb, var(--accent) 70%, transparent);"></i>Notes / Policy</span>
            <span class="accent-text group-open:rotate-180 transition">+</span>
          </summary>
          <div class="p-4 pt-0 text-gray-400 text-sm leading-relaxed" id="policyInfo"></div>
        </details>
      </div>
    </section>

    <section class="max-w-3xl mx-auto px-6 mb-24 reveal">
      <div class="text-center mb-12">
        <h2 class="font-luxury text-3xl text-gold-shine">The Evening Program</h2>
      </div>

      <div class="relative border-l accent-border ml-6" id="timeline"></div>
    </section>

    <section class="mb-16 reveal" id="gallery">
      <div class="text-center mb-8">
        <h2 class="font-luxury text-3xl text-white">Through The Years</h2>
        <p class="text-gray-500 text-xs mt-2" id="galleryNote">Swipe to view memories.</p>
      </div>
      <div class="flex overflow-x-auto gap-4 px-6 pb-8 snap-x hide-scrollbar" id="galleryRow"></div>
    </section>

    <section class="max-w-3xl mx-auto px-6 mb-24 reveal" id="photoUpload">
      <div class="panel border soft-line rounded-2xl p-8">
        <div class="text-center">
          <h2 class="font-luxury text-2xl accent-text mb-2">After-Party Photo Upload</h2>
          <p class="text-gray-400 text-sm mb-6">
            Share your favorite moments. Upload link opens in a new tab.
          </p>
          
          <a id="uploadLink" href="#" target="_blank" rel="noopener" 
             class="inline-flex items-center gap-2 px-7 py-3 rounded-full border accent-border text-xs text-white/80 hover:text-white hover:border-[color:var(--accent)] transition">
            <i class="fa-solid fa-cloud-arrow-up"></i> Upload Photos
          </a>

          <p class="text-[11px] mt-5" style="color: var(--muted); line-height:1.6;">
            Standard: upload is handled via Google Drive / Dropbox link (stable + no app needed).<br/>
            Premium: in-page upload + auto-gallery requires backend.
          </p>
        </div>
      </div>
    </section>

    <section class="max-w-4xl mx-auto px-6 mb-24 reveal" id="map">
      <div class="panel border soft-line rounded-xl overflow-hidden">
        <div class="p-6 border-b soft-line flex items-center justify-between gap-3 flex-wrap">
          <div>
            <h2 class="font-luxury text-2xl text-white">Map</h2>
            <p class="text-gray-500 text-xs mt-1" id="mapSub">Tap for directions.</p>
          </div>
          <div class="flex gap-2 flex-wrap">
            <a id="map-google-2" target="_blank" rel="noopener" 
               class="px-5 py-2 border soft-line rounded-full text-[11px] text-white/70 hover:text-white hover:border-[color:var(--accent)] transition"
               href="#">Google</a>
            <a id="map-apple-2" target="_blank" rel="noopener" 
               class="px-5 py-2 border soft-line rounded-full text-[11px] text-white/70 hover:text-white hover:border-[color:var(--accent)] transition"
               href="#">Apple</a>
            <a id="map-waze-2" target="_blank" rel="noopener" 
               class="px-5 py-2 border soft-line rounded-full text-[11px] text-white/70 hover:text-white hover:border-[color:var(--accent)] transition"
               href="#">Waze</a>
          </div>
        </div>
        
        <iframe id="mapFrame" class="w-full h-[420px]" 
                loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
      </div>
    </section>

    <section id="rsvp" class="max-w-xl mx-auto px-6 pb-16 reveal">
      <div class="relative panel border accent-border p-8 md:p-12 rounded-t-[3rem] shadow-[0_-10px_40px_rgba(0,0,0,0.45)]">
        <div class="absolute -top-3 left-1/2 transform -translate-x-1/2 w-32 h-6 rounded-b-full border-b accent-border" style="background: var(--bg);"></div>
        
        <div class="text-center mb-8">
          <h2 class="font-luxury text-4xl text-white mb-2">R.S.V.P</h2>
          <p class="accent-dim text-sm uppercase tracking-widest" id="rsvpDeadline">By October 10th</p>
        </div>

        <div id="success-msg" class="hidden text-center py-10">
          <i class="fa-regular fa-circle-check text-5xl accent-text mb-4"></i>
          <h3 class="text-white font-luxury text-xl">Confirmed!</h3>
          <p class="text-gray-500 mt-2" id="successText">See you on the dance floor.</p>

          <div class="mt-7 flex flex-wrap justify-center gap-3">
            <button id="successIcs" class="px-5 py-3 border accent-border rounded-full text-xs text-white/80 hover:text-white hover:border-[color:var(--accent)] transition">
              <i class="fa-regular fa-calendar mr-2"></i> Download .ics
            </button>
            <a id="successGcal" target="_blank" rel="noopener" 
               class="px-5 py-3 border accent-border rounded-full text-xs text-white/80 hover:text-white hover:border-[color:var(--accent)] transition"
               href="#">
              <i class="fa-brands fa-google mr-2"></i> Google Calendar
            </a>
            <a id="successDirections" target="_blank" rel="noopener" 
               class="px-5 py-3 border accent-border rounded-full text-xs text-white/80 hover:text-white hover:border-[color:var(--accent)] transition"
               href="#">
              <i class="fa-solid fa-location-dot mr-2"></i> Directions
            </a>
            <button id="successShare" class="px-5 py-3 border accent-border rounded-full text-xs text-white/80 hover:text-white hover:border-[color:var(--accent)] transition">
              <i class="fa-solid fa-link mr-2"></i> Share
            </button>
          </div>
        </div>

        <form id="rsvpForm" action="https://formspree.io/f/XXXXXXXX" method="POST" class="space-y-5">
          <div>
            <input type="text" name="name" required placeholder="Guest Name(s)" 
              class="w-full bg-black/30 border-b border-white/20 py-3 text-white focus:outline-none focus:border-[color:var(--accent)] transition placeholder-gray-600">
          </div>

          <div class="flex gap-4">
            <label class="flex-1 cursor-pointer">
              <input type="radio" name="attendance" value="Attending" class="peer hidden" checked>
              <div class="py-3 text-center border soft-line rounded text-gray-400 peer-checked:bg-[color:var(--accent)] peer-checked:text-black peer-checked:font-bold transition">Accept</div>
            </label>
            <label class="flex-1 cursor-pointer">
              <input type="radio" name="attendance" value="Decline" class="peer hidden">
              <div class="py-3 text-center border soft-line rounded text-gray-400 peer-checked:bg-red-900/40 peer-checked:text-white peer-checked:border-red-800 transition">Decline</div>
            </label>
          </div>

          <div id="extra-fields" class="space-y-5">
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="text-xs uppercase tracking-widest" style="color: var(--muted);">Adults</label>
                <select name="adults" class="mt-2 w-full bg-black/30 border-b border-white/20 py-3 text-white focus:outline-none focus:border-[color:var(--accent)] transition">
                  <option value="1" class="bg-black">1</option>
                  <option value="2" class="bg-black">2</option>
                  <option value="3" class="bg-black">3</option>
                  <option value="4" class="bg-black">4</option>
                </select>
              </div>

              <div>
                <label class="text-xs uppercase tracking-widest" style="color: var(--muted);">Kids</label>
                <select name="kids" class="mt-2 w-full bg-black/30 border-b border-white/20 py-3 text-white focus:outline-none focus:border-[color:var(--accent)] transition">
                  <option value="0" class="bg-black">0</option>
                  <option value="1" class="bg-black">1</option>
                  <option value="2" class="bg-black">2</option>
                  <option value="3" class="bg-black">3</option>
                </select>
              </div>
            </div>

            <div>
              <label class="text-xs uppercase tracking-widest" style="color: var(--muted);">Dietary</label>
              <select name="dietary" class="mt-2 w-full bg-black/30 border-b border-white/20 py-3 text-white focus:outline-none focus:border-[color:var(--accent)] transition">
                <option value="No preference" class="bg-black">No preference</option>
                <option value="Vegetarian" class="bg-black">Vegetarian</option>
                <option value="Vegan" class="bg-black">Vegan</option>
                <option value="Gluten-free" class="bg-black">Gluten-free</option>
                <option value="Halal" class="bg-black">Halal</option>
              </select>
            </div>

            <div>
              <input type="text" name="allergies" placeholder="Allergies (optional)" 
                class="w-full bg-black/30 border-b border-white/20 py-3 text-white focus:outline-none focus:border-[color:var(--accent)] transition placeholder-gray-600 text-sm">
            </div>

            <div>
              <input type="text" name="song_request" placeholder="üéµ Song Request for DJ (optional)" 
                class="w-full bg-black/30 border-b border-white/20 py-3 text-white focus:outline-none focus:border-[color:var(--accent)] transition placeholder-gray-600 text-sm">
            </div>

            <div>
              <textarea name="note" placeholder="Message to the host (optional)" 
                class="w-full bg-black/30 border border-white/10 rounded-xl p-4 text-white focus:outline-none focus:border-[color:var(--accent)] transition placeholder-gray-600 text-sm"
                rows="3"></textarea>
            </div>
          </div>

          <button type="submit" id="submit-btn"
            class="w-full bg-[color:var(--accent)] hover:bg-white hover:text-black text-black font-luxury font-bold py-4 rounded shadow-[0_0_20px_rgba(212,175,55,0.35)] transition duration-500 mt-2">
            CONFIRM
          </button>

          <p class="text-gray-600 text-[11px] leading-relaxed">
            Standard: RSVP is collected via your chosen endpoint (Formspree/Google Form).<br/>
            Premium: backend confirmations + live guestbook + photo upload + analytics report.
          </p>
        </form>
      </div>
    </section>

    <section class="max-w-3xl mx-auto px-6 pb-24 reveal" id="guestbook">
      <div class="panel border soft-line rounded-2xl p-8">
        <div class="text-center">
          <h2 class="font-luxury text-2xl accent-text mb-2">Digital Guestbook</h2>
          <p class="text-gray-400 text-sm mb-6">
            Leave a short note. (Standard: messages are collected to the host inbox/sheet.)
          </p>
        </div>

        <form id="guestbookForm" action="https://formspree.io/f/XXXXXXXX" method="POST" class="space-y-4">
          <div class="grid md:grid-cols-2 gap-4">
            <input name="guest_name" required placeholder="Your Name" 
              class="w-full bg-black/30 border-b border-white/20 py-3 text-white focus:outline-none focus:border-[color:var(--accent)] transition placeholder-gray-600">
            <input name="guest_city" placeholder="City (optional)" 
              class="w-full bg-black/30 border-b border-white/20 py-3 text-white focus:outline-none focus:border-[color:var(--accent)] transition placeholder-gray-600">
          </div>

          <textarea name="guest_message" required placeholder="Your message..." 
            class="w-full bg-black/30 border border-white/10 rounded-xl p-4 text-white focus:outline-none focus:border-[color:var(--accent)] transition placeholder-gray-600"
            rows="4"></textarea>

          <button type="submit" id="guestbookBtn" 
            class="w-full border accent-border rounded-xl py-4 text-xs text-white/85 hover:border-[color:var(--accent)] hover:text-white transition">
            SEND MESSAGE
          </button>

          <div id="guestbookOk" class="hidden text-center text-xs mt-3" style="color: var(--muted);">
            Thank you. Your message has been sent.
          </div>
        </form>

        <div class="mt-10 border-t soft-line pt-8">
          <div class="flex items-center justify-between flex-wrap gap-3">
            <h3 class="font-luxury text-lg text-white">Messages (Preview)</h3>
            <button id="openAdmin" class="text-[11px] px-4 py-2 rounded-full border soft-line hover:border-[color:var(--accent)] transition">
              Admin Panel
            </button>
          </div>

          <p class="text-[11px] mt-2" style="color: var(--muted); line-height:1.6;">
            This preview uses device storage for demo/backup. For a true live guestbook visible to everyone, Premium backend is required.
          </p>

          <div id="guestbookList" class="mt-6 grid gap-3"></div>
        </div>
      </div>
    </section>

    <footer class="text-center py-8 border-t soft-line text-gray-600 text-xs">
      One-time purchase ¬∑ No subscription ¬∑ Not a PDF ¬∑ Delivered as a private shareable link
      <div class="mt-2 opacity-0 select-none" aria-hidden="true">admin</div>
    </footer>

    <div id="analyticsMount"></div>
  </div>

  <div id="adminModal" role="dialog" aria-modal="true">
    <div class="w-full max-w-3xl panel border soft-line rounded-2xl p-6 shadow-[0_30px_80px_rgba(0,0,0,.55)]">
      <div class="flex items-start justify-between gap-4">
        <div>
          <h2 class="font-luxury text-xl accent-text">Admin Panel (Local)</h2>
          <p class="text-[11px]" style="color: var(--muted);">
            Export CSV / view locally saved submissions. For real-time multi-guest admin, Premium backend is required.
          </p>
        </div>
        <button id="closeAdmin" class="w-10 h-10 rounded-full border soft-line hover:border-[color:var(--accent)] transition">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>

      <div class="mt-6 grid md:grid-cols-2 gap-4">
        <div class="panel-strong border soft-line rounded-xl p-4">
          <div class="flex items-center justify-between">
            <h3 class="font-luxury text-sm text-white">RSVP (Local)</h3>
            <button id="exportRsvp" class="text-[11px] px-3 py-2 rounded-full border soft-line hover:border-[color:var(--accent)] transition">Export CSV</button>
          </div>
          <div id="rsvpLocalList" class="mt-4 grid gap-2 text-[12px]" style="color: rgba(255,255,255,.78);"></div>
        </div>

        <div class="panel-strong border soft-line rounded-xl p-4">
          <div class="flex items-center justify-between">
            <h3 class="font-luxury text-sm text-white">Guestbook (Local)</h3>
            <button id="exportGuestbook" class="text-[11px] px-3 py-2 rounded-full border soft-line hover:border-[color:var(--accent)] transition">Export CSV</button>
          </div>
          <div id="guestbookLocalList" class="mt-4 grid gap-2 text-[12px]" style="color: rgba(255,255,255,.78);"></div>
        </div>
      </div>

      <div class="mt-6 panel-strong border soft-line rounded-xl p-4">
        <h3 class="font-luxury text-sm text-white">Admin Unlock</h3>
        <p class="text-[11px]" style="color: var(--muted);">Enter admin code to enable exports and view entries.</p>

        <div class="mt-3 flex gap-3 flex-wrap items-center">
          <input id="adminCode" placeholder="Admin code" 
            class="flex-1 min-w-[220px] bg-black/30 border-b border-white/20 py-3 text-white focus:outline-none focus:border-[color:var(--accent)] transition placeholder-gray-600" />
          <button id="adminUnlock" class="px-5 py-3 rounded-full border accent-border text-xs hover:border-[color:var(--accent)] transition">
            Unlock
          </button>
          <span id="adminState" class="text-[11px]" style="color: var(--muted);">Locked</span>
        </div>
      </div>
    </div>
  </div>

  <script>
    /* =========================
       CONFIG (EDIT ONLY THIS)
    ========================== */
    const CONFIG = {
      // Security
      accessPin: "2580",
      adminPin: "9999",

      // Google Sheets (Apps Script Web App)
      databaseURL: "https://script.google.com/macros/s/AKfycbz3LWBMHEboYV4xKhfc7_VkFzDDc8y5rPpewRE-hGpLD3RbyicPXjWKRTsPrgUWuE09/exec",

      // Theme
      theme: "vip",

      // Entrance
      monogram: "S",
      entranceTitle: "PRIVATE EVENT",
      entranceSubtitle: "Click to Reveal Invitation",
      entranceButton: "OPEN ENVELOPE",

      // Hero
      heroTop: "Join us for the 30th Birthday of",
      celebrantName: "SOPHIA",
      heroQuote: "\"A Night of Elegance & Memories\"",

      // Event datetime
      eventStartISO: "2026-10-25T19:00:00-04:00",
      eventEndISO:   "2026-10-26T01:00:00-04:00",
      
      whenDateText: "Saturday, October 25th, 2026",
      whenTimeText: "19:00 - Late",

      // Venue
      venueName: "The Grand Ballroom",
      venueAddress: "123 Luxury Ave, Manhattan, NY",
      venueQuery: "The Grand Ballroom, 123 Luxury Ave, Manhattan, NY",

      // Dress code / registry
      dressCode: "Black Tie / Formal",
      paletteNote: "Please stick to the palette.",
      registryNote: "Your presence is the greatest gift.",
      registryUrl: "#",

      // Guest guide
      parkingInfo: "Valet parking is available at the entrance. Please arrive 10‚Äì15 minutes early for a smooth entry.",
      contactInfo: "For any questions: <span class='text-white'>+1 (000) 000-0000</span> (Host).",
      policyInfo: "Kindly RSVP by the deadline. Venue is adults-only unless stated otherwise. Please respect the dress code.",

      // RSVP
      rsvpDeadlineText: "By October 10th",
      rsvpEndpoint: "https://formspree.io/f/XXXXXXXX",
      successText: "See you on the dance floor.",

      // Guestbook
      guestbookEndpoint: "https://formspree.io/f/XXXXXXXX",

      // Media (LOCAL)
      enableBgVideo: true,
      bgVideoSrc: "assets/bg.mp4",
      momentVideoSrc: "assets/moment.mp4",
      musicSrc: "assets/music.mp3",
      
      // Gallery images
      galleryImages: [
        "assets/gallery/1.jpg",
        "assets/gallery/2.jpg",
        "assets/gallery/3.jpg",
        "assets/gallery/4.jpg",
      ],
      
      // Photo upload link
      photoUploadUrl: "https://drive.google.com/",

      // Map embed (will be auto-synced to venueQuery below)
      mapEmbedUrl: "",

      // Timeline
      timeline: [
        { time: "19:00", title: "Welcome Cocktails", note: "Champagne & Jazz" },
        { time: "20:00", title: "Gala Dinner", note: "Three-course meal" },
        { time: "22:00", title: "Cake & Toast", note: "Let the party begin!" },
      ],

      // Analytics
      enableAnalytics: false,
      analyticsEmbedHtml: ""
    };

    // Keep map embed always in sync with venueQuery (structure preserved)
    CONFIG.mapEmbedUrl = "https://www.google.com/maps?q=" + encodeURIComponent(CONFIG.venueQuery) + "&output=embed";

    /* =========================
       GELƒ∞≈ûMƒ∞≈û TEMA AYARLARI
    ========================== */
    const THEMES = {
      vip: { 
        type: "dark",
        bg: "#080808", 
        text: "rgba(255,255,255,0.95)",
        muted: "rgba(255,255,255,0.6)",
        panel: "rgba(255,255,255,0.05)", 
        line: "rgba(255,255,255,0.15)", 
        accent: "#D4AF37", /* Kraliyet Altƒ±nƒ± */
        accent2: "#8A7036"
      },
      ivory: { 
        type: "light",
        bg: "#F2F0E9", /* Kƒ±rƒ±k Beyaz / Krem */
        text: "#2C2C2C", /* Koyu Antrasit */
        muted: "#666666",
        panel: "rgba(0,0,0,0.03)", 
        line: "rgba(0,0,0,0.1)", 
        accent: "#8B7E66", /* Vizon / Taupe */
        accent2: "#5C5343"
      },
      floral: { 
        type: "light",
        bg: "#FFF5F7", /* √áok u√ßuk pudra */
        text: "#4A2C32", /* Koyu Bordo/Kahve */
        muted: "#8C6A72",
        panel: "rgba(74,44,50,0.04)", 
        line: "rgba(74,44,50,0.1)", 
        accent: "#D48BA1", /* G√ºl Kurusu */
        accent2: "#A65C70"
      },
      boho: { 
        type: "dark",
        bg: "#1E1B18", /* Koyu Espresso */
        text: "#E6DCCA", /* Kemik Rengi */
        muted: "#9C8E7E",
        panel: "rgba(255,255,255,0.04)", 
        line: "rgba(255,255,255,0.1)", 
        accent: "#C66B3D", /* Yanƒ±k Turuncu / Terracotta */
        accent2: "#8F4620"
      }
    };

    /* =========================
       helpers
    ========================== */
    const $ = (id) => document.getElementById(id);
    const LS = {
      rsvpKey: "vipInvite_rsvp",
      guestbookKey: "vipInvite_guestbook",
      unlockSessionKey: "vipInvite_unlocked_session",
      unlockDeviceKey: "vipInvite_unlocked_device"
    };

    function setRootVar(name, val){ document.documentElement.style.setProperty(name, val); }
    function safeSetText(id, text){ const el = $(id); if(el) el.textContent = text; }
    function safeSetHTML(id, html){ const el = $(id); if(el) el.innerHTML = html; }
    function fmt2(n){ return String(n).padStart(2,'0'); }

    function buildGoogleMapsLink(query){ return "https://www.google.com/maps/search/?api=1&query=" + encodeURIComponent(query); }
    function buildAppleMapsLink(query){ return "https://maps.apple.com/?q=" + encodeURIComponent(query); }
    function buildWazeLink(query){ return "https://waze.com/ul?q=" + encodeURIComponent(query) + "&navigate=yes"; }

    function escapeICSText(s){
      return String(s)
        .replace(/\\/g,"\\\\")
        .replace(/\n/g,"\\n")
        .replace(/,/g,"\\,")
        .replace(/;/g,"\\;");
    }

    function downloadICS({title, startISO, endISO, location, description}){
      const dtStamp = new Date().toISOString().replace(/[-:]/g,'').split('.')[0] + "Z";
      const start = new Date(startISO);
      const end = new Date(endISO);
      const toICS = (d) => {
        const yyyy = d.getUTCFullYear();
        const mm = fmt2(d.getUTCMonth()+1);
        const dd = fmt2(d.getUTCDate());
        const hh = fmt2(d.getUTCHours());
        const mi = fmt2(d.getUTCMinutes());
        const ss = fmt2(d.getUTCSeconds());
        return `${yyyy}${mm}${dd}T${hh}${mi}${ss}Z`;
      };
      const uid = `invite-${Math.random().toString(16).slice(2)}@invite`;
      const ics = 
`BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//VIP Invite//EN
CALSCALE:GREGORIAN
METHOD:PUBLISH
BEGIN:VEVENT
UID:${uid}
DTSTAMP:${dtStamp}
DTSTART:${toICS(start)}
DTEND:${toICS(end)}
SUMMARY:${escapeICSText(title)}
LOCATION:${escapeICSText(location)}
DESCRIPTION:${escapeICSText(description || "")}
END:VEVENT
END:VCALENDAR`;

      const blob = new Blob([ics], {type:"text/calendar;charset=utf-8"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = `${title.replace(/[^\w]+/g,'_')}.ics`;
      document.body.appendChild(a);
      a.click();
      a.remove();
      setTimeout(()=>URL.revokeObjectURL(a.href), 1200);
    }

    function buildGoogleCalendarLink({title, startISO, endISO, location, details}){
      const start = new Date(startISO);
      const end = new Date(endISO);
      const toGCal = (d) => {
        const yyyy = d.getUTCFullYear();
        const mm = fmt2(d.getUTCMonth()+1);
        const dd = fmt2(d.getUTCDate());
        const hh = fmt2(d.getUTCHours());
        const mi = fmt2(d.getUTCMinutes());
        const ss = fmt2(d.getUTCSeconds());
        return `${yyyy}${mm}${dd}T${hh}${mi}${ss}Z`;
      };
      const dates = `${toGCal(start)}/${toGCal(end)}`;
      const url = new URL("https://calendar.google.com/calendar/render");
      url.searchParams.set("action","TEMPLATE");
      url.searchParams.set("text", title);
      url.searchParams.set("dates", dates);
      url.searchParams.set("location", location);
      url.searchParams.set("details", details || "");
      return url.toString();
    }

    function genQR(elId, text){
      const el = $(elId);
      if(!el) return;
      el.innerHTML = "";
      if(window.QRCode){
        QRCode.toCanvas(text, { width: 120, margin: 1 }, (err, canvas) => {
          if(err){
            el.innerHTML = "<span class='text-gray-600 text-xs'>QR error</span>";
            return;
          }
          canvas.style.borderRadius = "10px";
          el.appendChild(canvas);
        });
      } else {
        el.innerHTML = "<span class='text-gray-600 text-xs'>QR unavailable</span>";
      }
    }

    function loadJSON(key, fallback){
      try{ return JSON.parse(localStorage.getItem(key) || "null") ?? fallback; }catch{ return fallback; }
    }
    function saveJSON(key, data){
      localStorage.setItem(key, JSON.stringify(data));
    }

    function toCSV(rows){
      if(!rows || !rows.length) return "";
      const esc = (v) => `"${String(v ?? "").replace(/"/g,'""')}"`;
      const headers = Object.keys(rows[0] || {});
      const lines = [
        headers.map(esc).join(","),
        ...rows.map(r => headers.map(h => esc(r[h])).join(","))
      ];
      return lines.join("\n");
    }
    function downloadText(filename, text, type="text/plain;charset=utf-8"){
      const blob = new Blob([text], {type});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      setTimeout(()=>URL.revokeObjectURL(a.href), 1200);
    }

    function escapeHtml(s){
      return String(s ?? "").replace(/[&<>"']/g, (c)=>({
        "&": "&",
        "<": "<",
        ">": ">",
        '"': "&quot;",
        "'": "&#39;"
      }[c]));
    }

    function revealAll(){
      document.querySelectorAll(".reveal").forEach(el=>{
        el.classList.add("active");
        el.style.opacity = "1";
        el.style.transform = "none";
      });
    }

    // =========================
    // JSONP helper (for Apps Script read, avoids CORS)
    // =========================
    function jsonp(url){
      return new Promise((resolve, reject)=>{
        const cb = "__jsonp_cb_" + Date.now() + "_" + Math.floor(Math.random()*99999);
        const script = document.createElement("script");

        window[cb] = (data)=>{
          cleanup();
          resolve(data);
        };

        function cleanup(){
          try{ delete window[cb]; }catch{ window[cb] = undefined; }
          if(script && script.parentNode) script.parentNode.removeChild(script);
        }

        script.onerror = ()=>{
          cleanup();
          reject(new Error("JSONP load error"));
        };

        const sep = url.includes("?") ? "&" : "?";
        script.src = url + sep + "callback=" + encodeURIComponent(cb);
        document.body.appendChild(script);
      });
    }

    /* =========================
       Theme apply (UPDATED LOGIC)
    ========================== */
    function applyTheme(themeKey){
      const t = THEMES[themeKey] || THEMES.vip;
      
      // 1. Renk Deƒüi≈ükenlerini Ata
      setRootVar("--bg", t.bg);
      setRootVar("--text", t.text);
      setRootVar("--muted", t.muted);
      setRootVar("--panel", t.panel);
      setRootVar("--line", t.line);
      setRootVar("--accent", t.accent);
      setRootVar("--accent2", t.accent2);

      // 2. Body Rengi ve Metin Rengini Zorla
      document.body.style.backgroundColor = t.bg;
      document.body.style.color = t.text;

      // 3. Mod Sƒ±nƒ±flarƒ±nƒ± Y√∂net (Light/Dark Mode ve VIP √áer√ßeve)
      // √ñnce temizle
      document.body.classList.remove("theme-vip", "theme-ivory", "theme-floral", "theme-boho", "light-mode");
      
      // Yeni sƒ±nƒ±flarƒ± ekle
      document.body.classList.add(`theme-${themeKey}`);
      
      if(t.type === "light"){
        document.body.classList.add("light-mode");
        // ƒ∞konlarƒ± ve diƒüer √∂ƒüeleri koyula≈ütƒ±r
        document.documentElement.style.setProperty('--shadow', '0 30px 80px rgba(0,0,0,0.15)');
      } else {
        document.documentElement.style.setProperty('--shadow', '0 30px 80px rgba(0,0,0,0.55)');
      }
    }

    applyTheme(CONFIG.theme);

    // Entrance theme selector preview
    document.querySelectorAll(".themeBtn").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const k = btn.getAttribute("data-theme");
        applyTheme(k);
      });
    });

    /* =========================
       Apply CONFIG to UI
    ========================== */
    safeSetText("monogram", CONFIG.monogram);
    safeSetText("privateLabel", CONFIG.entranceTitle);
    safeSetText("clickLabel", CONFIG.entranceSubtitle);
    safeSetText("open-btn", CONFIG.entranceButton);

    safeSetText("pinMonogram", CONFIG.monogram);
    safeSetText("heroTop", CONFIG.heroTop);
    safeSetText("heroName", CONFIG.celebrantName);
    safeSetText("heroQuote", CONFIG.heroQuote);

    safeSetText("whenDate", CONFIG.whenDateText);
    safeSetText("whenTime", CONFIG.whenTimeText);

    safeSetText("whereName", CONFIG.venueName);
    safeSetText("whereAddress", CONFIG.venueAddress);

    safeSetText("dressCode", CONFIG.dressCode);
    safeSetText("paletteNote", CONFIG.paletteNote);
    safeSetText("registryNote", CONFIG.registryNote);
    $("registryLink").href = CONFIG.registryUrl || "#";

    safeSetHTML("parkingInfo", CONFIG.parkingInfo);
    safeSetHTML("contactInfo", CONFIG.contactInfo);
    safeSetHTML("policyInfo", CONFIG.policyInfo);

    safeSetText("rsvpDeadline", CONFIG.rsvpDeadlineText);
    safeSetText("successText", CONFIG.successText);

    $("rsvpForm").action = CONFIG.rsvpEndpoint;
    $("guestbookForm").action = CONFIG.guestbookEndpoint;

    $("uploadLink").href = CONFIG.photoUploadUrl || "#";

    /* =========================
       Media sources (local)
    ========================== */
    const musicEl = $("bgMusic");
    const musicBtn = $("music-btn");
    const musicSource = musicEl.querySelector("source");
    musicSource.src = CONFIG.musicSrc;
    musicEl.load();

    const bgVideo = $("bgVideo");
    if(CONFIG.enableBgVideo && CONFIG.bgVideoSrc){
      bgVideo.querySelector("source").src = CONFIG.bgVideoSrc;
      bgVideo.load();
      bgVideo.play().catch(()=>{});
      bgVideo.addEventListener("error", ()=>{ bgVideo.style.display="none"; });
    } else {
      bgVideo.style.display = "none";
    }

    const momentWrap = $("momentWrap");
    const momentVideo = $("momentVideo");
    if(CONFIG.momentVideoSrc){
      momentVideo.querySelector("source").src = CONFIG.momentVideoSrc;
      momentVideo.load();
      momentVideo.addEventListener("error", ()=>{ momentWrap.style.display="none"; });
    } else {
      momentWrap.style.display = "none";
    }

    // Hide music button if missing
    musicEl.addEventListener("error", ()=>{ musicBtn.style.display = "none"; });

    /* =========================
       Map + Calendar
    ========================== */
    const gLink = buildGoogleMapsLink(CONFIG.venueQuery);
    const aLink = buildAppleMapsLink(CONFIG.venueQuery);
    const wLink = buildWazeLink(CONFIG.venueQuery);

    $("map-google").href = gLink;
    $("map-apple").href = aLink;
    $("map-waze").href = wLink;
    $("map-google-2").href = gLink;
    $("map-apple-2").href = aLink;
    $("map-waze-2").href = wLink;

    $("mapFrame").src = CONFIG.mapEmbedUrl;

    const calTitle = `${CONFIG.celebrantName} ¬∑ VIP Celebration`;
    const gcal = buildGoogleCalendarLink({
      title: calTitle,
      startISO: CONFIG.eventStartISO,
      endISO: CONFIG.eventEndISO,
      location: `${CONFIG.venueName} ‚Äî ${CONFIG.venueAddress}`,
      details: "Invitation: " + (location.href || "")
    });
    $("gcal-link").href = gcal;
    $("successGcal").href = gcal;
    $("successDirections").href = gLink;

    const icsHandler = () => downloadICS({
      title: calTitle,
      startISO: CONFIG.eventStartISO,
      endISO: CONFIG.eventEndISO,
      location: `${CONFIG.venueName} ‚Äî ${CONFIG.venueAddress}`,
      description: `Dress Code: ${CONFIG.dressCode}\n\nDirections: ${gLink}\n\nRSVP: ${location.origin + location.pathname}#rsvp`
    });

    $("ics-btn").addEventListener("click", icsHandler);
    $("successIcs").addEventListener("click", icsHandler);

    /* =========================
       Timeline render
    ========================== */
    const timeline = $("timeline");
    timeline.innerHTML = "";
    CONFIG.timeline.forEach(item => {
      const block = document.createElement("div");
      block.className = "mb-12 ml-8 relative";
      block.innerHTML = `
        <div class="absolute -left-[41px] w-5 h-5 rounded-full border-4 shadow-[0_0_10px_rgba(0,0,0,.2)]"
             style="background: var(--accent); border-color: var(--bg); box-shadow: 0 0 10px color-mix(in srgb, var(--accent) 75%, transparent);"></div>
        <span class="accent-text font-bold text-sm tracking-widest">${escapeHtml(item.time)}</span>
        <h4 class="font-luxury text-xl mt-1" style="color: var(--text);">${escapeHtml(item.title)}</h4>
        <p class="text-gray-500 text-sm italic">${escapeHtml(item.note || "")}</p>
      `;
      timeline.appendChild(block);
    });

    /* =========================
       Gallery render
    ========================== */
    const galleryRow = $("galleryRow");
    galleryRow.innerHTML = "";
    CONFIG.galleryImages.forEach(src => {
      const card = document.createElement("div");
      card.className = "flex-shrink-0 snap-center w-64 aspect-[3/4] panel p-2 border soft-line rounded-lg";
      card.innerHTML = `<img src="${src}" class="w-full h-full object-cover rounded opacity-80 hover:opacity-100 transition" alt="Memory" 
                          onerror="this.closest('.flex-shrink-0').style.display='none'">`;
      galleryRow.appendChild(card);
    });

    /* =========================
       Analytics optional
    ========================== */
    if(CONFIG.enableAnalytics && CONFIG.analyticsEmbedHtml){
      $("analyticsMount").innerHTML = CONFIG.analyticsEmbedHtml;
    }

    /* =========================
       PIN Gate logic
    ========================== */
    const pinScreen = $("pin-screen");
    const pinInput = $("pinInput");
    const pinSubmit = $("pinSubmit");
    const pinError = $("pinError");
    const pinBox = $("pinBox");
    const rememberDevice = $("rememberDevice");

    function showPinGate(){
      pinScreen.classList.add("active");
      setTimeout(()=>pinInput.focus(), 120);
    }
    function hidePinGate(){
      pinScreen.classList.remove("active");
    }

    const unlockedSession = sessionStorage.getItem(LS.unlockSessionKey) === "1";
    const unlockedDevice  = localStorage.getItem(LS.unlockDeviceKey) === "1";

    if(!unlockedSession && !unlockedDevice){
      showPinGate();
    }

    function tryUnlock(){
      const v = (pinInput.value || "").trim();
      if(v === CONFIG.accessPin){
        pinError.classList.add("hidden");
        pinBox.classList.remove("shake");
        hidePinGate();
        
        sessionStorage.setItem(LS.unlockSessionKey, "1");
        if(rememberDevice.checked){
          localStorage.setItem(LS.unlockDeviceKey, "1");
        }
      } else {
        pinError.classList.remove("hidden");
        pinBox.classList.remove("shake");
        void pinBox.offsetWidth;
        pinBox.classList.add("shake");
      }
    }
    pinSubmit.addEventListener("click", tryUnlock);
    pinInput.addEventListener("keydown", (e)=>{ if(e.key==="Enter") tryUnlock(); });

    /* =========================
       Entrance + music start
    ========================== */
    const openBtn = $("open-btn");
    const entrance = $("entrance-screen");

    let musicPlaying = false;
    function setMusicUI(on){
      musicBtn.style.opacity = on ? "1" : "0.5";
      musicBtn.setAttribute("aria-pressed", on ? "true" : "false");
      musicBtn.title = on ? "Music: On" : "Music: Off";
    }
    setMusicUI(false);

    openBtn.addEventListener("click", () => {
      entrance.classList.add("envelope-hidden");
      
      confetti({
        particleCount: 160, spread: 70, origin: { y: 0.6 },
        colors: [getComputedStyle(document.documentElement).getPropertyValue("--accent").trim() || "#D4AF37", "#ffffff"]
      });

      // Start music (user gesture)
      musicEl.play()
        .then(() => { musicPlaying = true; setMusicUI(true); })
        .catch(() => { musicPlaying = false; setMusicUI(false); });

      // Reveal content
      setTimeout(()=> {
        revealAll();
        window.scrollTo({ top: 0, left: 0, behavior: "auto" });
      }, 220);
    });

    musicBtn.addEventListener("click", () => {
      if(musicPlaying){
        musicEl.pause();
        musicPlaying = false;
        setMusicUI(false);
      } else {
        musicEl.play()
          .then(() => { musicPlaying = true; setMusicUI(true); })
          .catch(() => { musicPlaying = false; setMusicUI(false); });
      }
    });

    /* =========================
       Share buttons
    ========================== */
    async function shareLink(){
      const link = location.href;
      try{
        if(navigator.share){
          await navigator.share({ title: calTitle, text: "VIP Invite", url: link });
        } else {
          await navigator.clipboard.writeText(link);
          return true;
        }
      } catch {}
      return false;
    }

    $("share-btn").addEventListener("click", async ()=>{
      const ok = await shareLink();
      if(ok){
        $("share-btn").innerHTML = "<i class='fa-solid fa-check mr-2'></i> Copied";
        setTimeout(()=> $("share-btn").innerHTML = "<i class='fa-solid fa-link mr-2'></i> Share Link", 1400);
      }
    });
    $("successShare").addEventListener("click", shareLink);

    /* =========================
       A2HS banner close
    ========================== */
    $("a2hsClose").addEventListener("click", ()=> $("a2hs").style.display="none");

    /* =========================
       Reveal on scroll
    ========================== */
    (function initReveal(){
      const els = document.querySelectorAll(".reveal");
      if(!els.length) return;

      if(!("IntersectionObserver" in window)){
        revealAll();
        return;
      }

      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if(entry.isIntersecting){
            entry.target.classList.add("active");
            observer.unobserve(entry.target);
          }
        });
      }, { threshold: 0.12 });

      els.forEach(el => observer.observe(el));
      
      setTimeout(()=>{
        els.forEach(el=>{
          const r = el.getBoundingClientRect();
          if(r.top < window.innerHeight * 1.05) el.classList.add("active");
        });
      }, 180);
    })();

    /* =========================
       Countdown
    ========================== */
    const targetDate = new Date(CONFIG.eventStartISO).getTime();
    const endDate = new Date(CONFIG.eventEndISO).getTime();

    function setStatus(text, iconClass){
      const badge = $("eventStatusBadge");
      $("eventStatusText").textContent = text;
      badge.querySelector("i").className = iconClass;
    }

    function tick(){
      const now = Date.now();
      const dist = targetDate - now;

      if(now < targetDate){
        setStatus("Counting down", "fa-regular fa-clock");
      } else if(now >= targetDate && now <= endDate){
        setStatus("Tonight ¬∑ Event in progress", "fa-solid fa-bolt");
      } else {
        setStatus("Thank you for coming", "fa-regular fa-heart");
      }

      if(dist <= 0){
        $("days").innerText = "00"; $("hours").innerText = "00"; $("minutes").innerText = "00"; $("seconds").innerText = "00";
        return;
      }

      const days = Math.floor(dist / (1000 * 60 * 60 * 24));
      const hours = Math.floor((dist % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((dist % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((dist % (1000 * 60)) / 1000);

      $("days").innerText = String(days).padStart(2,"0");
      $("hours").innerText = String(hours).padStart(2,"0");
      $("minutes").innerText = String(minutes).padStart(2,"0");
      $("seconds").innerText = String(seconds).padStart(2,"0");
    }
    tick();
    setInterval(tick, 1000);
    $("tzHint").textContent = "Time shown in your local timezone. (" + Intl.DateTimeFormat().resolvedOptions().timeZone + ")";

    /* =========================
       QR generation
    ========================== */
    const pageLink = location.href;
    const rsvpLink = pageLink.split("#")[0] + "#rsvp";
    const mapLink = gLink;

    genQR("qr-rsvp", rsvpLink);
    genQR("qr-map", mapLink);
    genQR("qr-share", pageLink);

    /* =========================
       RSVP logic
    ========================== */
    const rsvpForm = $("rsvpForm");
    const submitBtn = $("submit-btn");
    const successMsg = $("success-msg");
    const extraFields = $("extra-fields");
    const radios = document.querySelectorAll('input[name="attendance"]');

    function renderLocalRsvp(){
      const rsvpLocalList = $("rsvpLocalList");
      if(!rsvpLocalList) return;
      const rows = loadJSON(LS.rsvpKey, []);
      if(!rows.length){
        rsvpLocalList.innerHTML = `<div class="text-white/40 text-xs">No local entries.</div>`;
        return;
      }
      rsvpLocalList.innerHTML = rows.slice().reverse().map(row=>{
        const colorClass = (row.attendance === "Attending") ? "text-green-400" : "text-red-400";
        return `
          <div class="border-b border-white/10 pb-2 mb-2 text-[11px]">
            <div class="flex justify-between">
              <span class="accent-text font-bold">${escapeHtml(row.name || "Anonymous")}</span>
              <span class="${colorClass} font-mono uppercase">${escapeHtml(row.attendance || "")}</span>
            </div>
            <div class="text-white/50 mt-1">
              Guests: ${escapeHtml(row.adults ?? "-")} Adults, ${escapeHtml(row.kids ?? "-")} Kids | Dietary: ${escapeHtml(row.dietary ?? "-")}
            </div>
            ${row.note ? `<div class="text-white/70 italic mt-1 bg-white/5 p-1 rounded">"${escapeHtml(row.note)}"</div>` : ""}
            <div class="text-right text-[9px] text-white/20 mt-1">${escapeHtml(row.date || "")}</div>
          </div>
        `;
      }).join("");
    }
    renderLocalRsvp();

    radios.forEach(radio => {
      radio.addEventListener('change', (e) => {
        extraFields.style.display = e.target.value === 'Decline' ? 'none' : 'block';
      });
    });

    rsvpForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      submitBtn.innerText = "SENDING...";
      submitBtn.disabled = true;

      const fd = new FormData(rsvpForm);
      
      // Local save
      const localRow = {
        name: fd.get("name"),
        attendance: fd.get("attendance"),
        adults: fd.get("adults"),
        kids: fd.get("kids"),
        dietary: fd.get("dietary"),
        allergies: fd.get("allergies"),
        song_request: fd.get("song_request"),
        note: fd.get("note"),
        date: new Date().toLocaleString()
      };
      const localRows = loadJSON(LS.rsvpKey, []);
      localRows.push(localRow);
      saveJSON(LS.rsvpKey, localRows);
      renderLocalRsvp();

      try {
        const hasSheets = CONFIG.databaseURL && CONFIG.databaseURL.startsWith("http");

        if(hasSheets){
          // Apps Script (no-cors)
          await fetch(CONFIG.databaseURL, {
            method: 'POST',
            body: new URLSearchParams(fd),
            mode: 'no-cors'
          });
        } else {
          // Formspree fallback
          const res = await fetch(CONFIG.rsvpEndpoint, {
            method: "POST",
            headers: { "Accept": "application/json" },
            body: fd
          });
          if(!res.ok) throw new Error("Form endpoint failed");
        }

        // assume success
        rsvpForm.classList.add('hidden');
        successMsg.classList.remove('hidden');
        
        confetti({
          particleCount: 120, spread: 60, origin: { y: 0.75 },
          colors: [getComputedStyle(document.documentElement).getPropertyValue("--accent").trim() || "#D4AF37", "#ffffff"]
        });
      } catch {
        alert("Connection Error");
        submitBtn.innerText = "CONFIRM";
        submitBtn.disabled = false;
      }
    });

    /* =========================
       Guestbook logic
    ========================== */
    const guestbookForm = $("guestbookForm");
    const guestbookBtn = $("guestbookBtn");
    const guestbookOk = $("guestbookOk");
    const guestbookList = $("guestbookList");
    const guestbookLocalList = $("guestbookLocalList");

    function renderGuestbook(){
      const items = loadJSON(LS.guestbookKey, []);
      if(guestbookList){
        guestbookList.innerHTML = items.slice().reverse().map(m => `
          <div class="panel-strong border soft-line rounded-xl p-4">
            <div class="flex justify-between gap-3">
              <div class="accent-text font-bold text-sm">${escapeHtml(m.name || "Guest")}</div>
              <div class="text-[10px] text-white/40">${escapeHtml(m.date || "")}</div>
            </div>
            <div class="text-white/80 text-sm mt-2 leading-relaxed">"${escapeHtml(m.message || "")}"</div>
            ${m.city ? `<div class="text-[11px] text-white/50 mt-2">${escapeHtml(m.city)}</div>` : ""}
          </div>
        `).join("");
      }

      if(guestbookLocalList){
        guestbookLocalList.innerHTML = items.slice().reverse().map(m => `
          <div class="border-b border-white/10 pb-2 mb-2 text-[11px]">
            <div class="flex justify-between">
              <span class="accent-text font-bold">${escapeHtml(m.name || "Guest")}</span>
              <span class="text-white/30">${escapeHtml(m.date || "")}</span>
            </div>
            <div class="text-white/70 mt-1">"${escapeHtml(m.message || "")}"</div>
          </div>
        `).join("") || `<div class="text-white/40 text-xs">No local messages.</div>`;
      }
    }
    renderGuestbook();

    if(guestbookForm){
      guestbookForm.addEventListener("submit", async (e)=>{
        e.preventDefault();
        if(guestbookBtn){
          guestbookBtn.disabled = true;
          guestbookBtn.innerText = "SENDING...";
        }

        const fd = new FormData(guestbookForm);
        const entry = {
          name: fd.get("guest_name"),
          city: fd.get("guest_city"),
          message: fd.get("guest_message"),
          date: new Date().toLocaleString()
        };
        
        // local save
        const items = loadJSON(LS.guestbookKey, []);
        items.push(entry);
        saveJSON(LS.guestbookKey, items);
        renderGuestbook();

        // send to endpoint
        try{
          const res = await fetch(CONFIG.guestbookEndpoint, {
            method: "POST",
            headers: { "Accept": "application/json" },
            body: fd
          });
          if(!res.ok) throw new Error("Guestbook endpoint failed");

          guestbookForm.reset();
          if(guestbookOk) guestbookOk.classList.remove("hidden");
          setTimeout(()=> guestbookOk && guestbookOk.classList.add("hidden"), 2000);
        } catch {
          alert("Message saved locally, but could not be sent to the host endpoint.");
        } finally {
          if(guestbookBtn){
            guestbookBtn.disabled = false;
            guestbookBtn.innerText = "SEND MESSAGE";
          }
        }
      });
    }

    /* =========================
       Admin Panel (Google Sheets Linked)
    ========================== */
    async function fetchAndRenderAdminData() {
      const rsvpLocalList = document.getElementById("rsvpLocalList");
      rsvpLocalList.innerHTML = `<div class="text-white/50 text-xs animate-pulse">Loading live data from Google Sheets...</div>`;

      const hasSheets = CONFIG.databaseURL && CONFIG.databaseURL.startsWith("http");
      if(!hasSheets){
        rsvpLocalList.innerHTML = `<div class="text-white/40 text-xs">databaseURL not configured. Using local entries only.</div>`;
        return;
      }

      try {
        const data = await jsonp(CONFIG.databaseURL + "?action=read");
        
        const totalAttending = data.filter(r => r.Attendance === "Attending").length;
        const totalAdults = data.reduce((acc, curr) => acc + (parseInt(curr.Adults) || 0), 0);
        const totalKids = data.reduce((acc, curr) => acc + (parseInt(curr.Kids) || 0), 0);

        document.getElementById("adminState").innerHTML = `
          <span class="text-[10px] text-white/60">
            Entries: <b>${data.length}</b> | Attending: <b>${totalAttending}</b> (Adults: ${totalAdults}, Kids: ${totalKids})
          </span>`;

        rsvpLocalList.innerHTML = "";

        if (data.length === 0) {
          rsvpLocalList.innerHTML = `<div class="text-white/40 text-xs">No entries found.</div>`;
          return;
        }

        data.slice().reverse().forEach(row => {
          const colorClass = row.Attendance === "Attending" ? "text-green-400" : "text-red-400";
          const el = document.createElement("div");
          el.className = "border-b border-white/10 pb-2 mb-2 text-[11px]";
          el.innerHTML = `
            <div class="flex justify-between">
              <span class="accent-text font-bold">${escapeHtml(row.Name || 'Anonymous')}</span>
              <span class="${colorClass} font-mono uppercase">${escapeHtml(row.Attendance || '')}</span>
            </div>
            <div class="text-white/50 mt-1">
               Guests: ${escapeHtml(row.Adults || '-')} Adults, ${escapeHtml(row.Kids || '-')} Kids | Dietary: ${escapeHtml(row.Dietary || '-')}
            </div>
            ${row.Note ? `<div class="text-white/70 italic mt-1 bg-white/5 p-1 rounded">"${escapeHtml(row.Note)}"</div>` : ""}
            <div class="text-right text-[9px] text-white/20 mt-1">${escapeHtml(row.Date || '')}</div>
          `;
          rsvpLocalList.appendChild(el);
        });

      } catch (error) {
        rsvpLocalList.innerHTML = `<div class="text-red-400 text-xs">Error connecting to Google Sheets.</div>`;
        console.error("Fetch Error:", error);
      }
    }

    /* =========================
       Admin modal logic
    ========================== */
    const adminModal = $("adminModal");
    const openAdmin = $("openAdmin");
    const closeAdmin = $("closeAdmin");
    const adminUnlock = $("adminUnlock");
    const adminCode = $("adminCode");
    const adminState = $("adminState");

    let adminUnlocked = false;

    openAdmin.addEventListener("click", ()=>{
      adminModal.classList.add("open");
      setTimeout(()=>adminCode.focus(), 150);
      renderLocalRsvp();
      renderGuestbook();
    });
    closeAdmin.addEventListener("click", ()=> adminModal.classList.remove("open"));

    adminUnlock.addEventListener("click", ()=>{
      if((adminCode.value || "").trim() === CONFIG.adminPin){
        adminUnlocked = true;
        fetchAndRenderAdminData();
      } else {
        adminState.textContent = "Wrong code";
      }
    });

    /* =========================
       Export CSV handlers
    ========================== */
    const exportRsvp = $("exportRsvp");
    const exportGuestbook = $("exportGuestbook");

    if(exportRsvp){
      exportRsvp.addEventListener("click", ()=>{
        if(!adminUnlocked) return;
        const rows = loadJSON(LS.rsvpKey, []);
        if(!rows.length) return alert("No local RSVP data to export.");
        const csv = toCSV(rows);
        if(!csv) return alert("No local RSVP data to export.");
        downloadText("rsvp_local.csv", csv, "text/csv;charset=utf-8");
      });
    }

    if(exportGuestbook){
      exportGuestbook.addEventListener("click", ()=>{
        if(!adminUnlocked) return;
        const rows = loadJSON(LS.guestbookKey, []);
        if(!rows.length) return alert("No local guestbook data to export.");
        const csv = toCSV(rows);
        if(!csv) return alert("No local guestbook data to export.");
        downloadText("guestbook_local.csv", csv, "text/csv;charset=utf-8");
      });
    }

    /* =========================
       Final failsafe: Reveal
    ========================== */
    setTimeout(()=>{
      document.querySelectorAll(".reveal").forEach(el=>{
        const r = el.getBoundingClientRect();
        if(r.top < window.innerHeight * 1.1) el.classList.add("active");
      });
    }, 600);

  </script>
</body>
</html>
